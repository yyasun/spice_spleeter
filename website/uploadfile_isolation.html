<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="styles.css">
    <title>Sound Recognition Solutions</title>
</head>
<body>
    <nav class="container-fluid">
        <ul>
            <h3 style="margin-top: 10px; margin-bottom: 10px; margin-left: 10px; margin-right: 10px;" onclick="window.location.href='homepage.html';">LOGO</h3>
            
        </ul>
        <ul>
            <li><a href="contacts.html">Контакти</a></li>
            <li><a href="about_us.html">Про нас</a></li>
            <li><a href="help.html">Підтримка</a></li>
            <li><a href="archive.html" role="button">Архів  <img src="archive.svg" alt="Archive" class="archive"></a></li>
        </ul>
    </nav>
    <main class="container">
    <div class="upload-container">
        <h4 >Завантажте аудіофайл для ізоляції вокалу та видалення музичної доріжки</h4>
        <div class="file-upload-box">
            <input type="file" id="file-upload" hidden/>
            <label for="file-upload" class="file-drag">
                <img src="download-icon.svg" alt="Download" class="download-icon">
            <br> Choose a file or drag it here.
            </label>
        </div>
        <!-- Inside your <main> tag, after the file-upload-box div -->
<div id="progress-container" style="display:none;">
    <label for="file-progress">Uploading:</label>
    <progress id="file-progress" value="0" max="100"></progress>
</div>
<div id="output" width="100%"></div>
<button id="download" role="button" class="button2" style="display:none;" onclick="download();">Завантажити ізольований вокал</button>

    </main>
    <footer class="footer-text">
        Горобчук Марія. Група КН-41. Факультет Інформаційних технологій КНУ
    </footer>

    <script>
        var filename = "";

        function download() {
            var link = document.createElement('a');         
            link.href = "http://127.0.0.1:5000/download?filename="+filename;
            link.download = "vocals.wav";
            link.click();
        }
        document.getElementById('file-upload').addEventListener('change', function(event) {
            var file = event.target.files[0];
            var outputElement = document.getElementById("output");
            var progressBarContainer = document.getElementById('progress-container');
            var progressBar = document.getElementById('file-progress');
            var downloadButton = document.getElementById('download');

            progressBarContainer.style.display = 'block';
            progressBar.value = 0; // Reset progress bar value
            if (file) {
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "http://127.0.0.1:5000/upload/separate", true);
                xhr.upload.onprogress = function(event) {
                    if (event.lengthComputable) {
                        var percentComplete = (event.loaded / event.total) * 100;
                        progressBar.value = percentComplete;
                    }
                };

                xhr.onload = function() {
                    if (xhr.status == 201) {
                        var json = JSON.parse(xhr.response);                        
                        filename = json.filename;
                        
                        var audio = document.createElement('audio');         
                        audio.src = "http://127.0.0.1:5000/download?filename="+filename;
                        audio.controls = true;
                        
                        outputElement.appendChild(audio);

                        downloadButton.style.display = 'block'; // Show the "Розпізнати ноти" button
                    } else {
                        alert("Error uploading file");
                    }
                };

                var formData = new FormData();
                formData.append("file", file);
                xhr.send(formData);
            }
        });
        </script>
        
</body>
</html>
